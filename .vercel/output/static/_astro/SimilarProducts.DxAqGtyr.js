import{j as t}from"./jsx-runtime.D3GSbgeI.js";import{r as m}from"./index.bmQhMlF6.js";import{g as w}from"./supabaseClient.DQBRCACc.js";import{f as j}from"./currency.DLCe802R.js";import"./index.yBjzXJbu.js";import"./index.FHxf1fDt.js";function y({productId:u,handle:d,gender:c,limit:f=4}){const[p,h]=m.useState([]),[x,b]=m.useState({});return m.useEffect(()=>{(async()=>{const e=w();if(!e)return;let i=u;if(!i&&d){const{data:n}=await e.from("products").select("id").eq("handle",d).maybeSingle();i=n?.id||""}if(!i)return;const{data:o}=await e.from("products").select("id, collection_id, tags, gender").eq("id",i).single();if(!o)return;let r=e.from("products").select("id, title, handle, gender, price_gbp, tags, is_new").eq("status","published").neq("id",i);o.collection_id&&(r=r.eq("collection_id",o.collection_id)),c?r=r.eq("gender",c):o.gender&&(r=r.eq("gender",o.gender));const{data:a}=await r.limit(f);if(a&&a.length>0){h(a);const n=a.map(s=>s.id),{data:g}=await e.from("product_images").select("product_id, url").in("product_id",n).order("position",{ascending:!0});if(g){const s={};g.forEach(l=>{s[l.product_id]||(s[l.product_id]=l.url)}),b(s)}}})()},[u,d,c,f]),p.length===0?null:t.jsxs("div",{className:"w-full",children:[t.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-light mb-8 text-center text-[rgb(38,19,21)] tracking-tight",children:"View Similar Products"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:p.map(e=>t.jsxs("a",{href:`/product?handle=${encodeURIComponent(e.handle)}&id=${encodeURIComponent(e.id)}&from=${encodeURIComponent(window.location.pathname)}`,className:"group block overflow-hidden rounded-xl border border-[rgb(38,19,21)]/10 hover:border-[rgb(38,19,21)]/20 hover:shadow-xl transition-all duration-300",children:[t.jsxs("div",{className:"aspect-[3/4] overflow-hidden bg-neutral-50",children:[e.is_new&&t.jsx("div",{className:"absolute top-3 left-3 z-10 bg-[rgb(38,19,21)] text-white px-2 py-1 text-[10px] font-medium tracking-wider",children:"NEW"}),t.jsx("img",{src:x[e.id]||"https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?q=80&w=2835&auto=format&fit=crop",alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700 ease-out"})]}),t.jsxs("div",{className:"p-4 bg-white",children:[t.jsx("h3",{className:"text-sm font-light tracking-wide text-[rgb(38,19,21)] mb-1.5 line-clamp-2",children:e.title}),t.jsx("p",{className:"text-sm font-medium text-[rgb(38,19,21)]",children:j((e.price_gbp||0)*100,"GBP")})]})]},e.id))})]})}export{y as default};
