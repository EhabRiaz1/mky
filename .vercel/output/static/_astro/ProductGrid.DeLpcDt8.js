import{j as t}from"./jsx-runtime.D3GSbgeI.js";import{r as d}from"./index.bmQhMlF6.js";import{g as j}from"./supabaseClient.DQBRCACc.js";import"./index.yBjzXJbu.js";import"./index.FHxf1fDt.js";function P({gender:a,collection:c}){const[h,m]=d.useState([]),[g,p]=d.useState({}),[f,x]=d.useState(new Set);d.useEffect(()=>{(async()=>{console.log("[ProductGrid] Fetching products for gender:",a,"collection:",c);const e=j();if(!e)return;let s=e.from("products").select("id,title,handle,gender,price_gbp,tags").eq("status","published");a&&(s=s.eq("gender",a));let l;if(c){let i=e.from("v_published_products_with_collections").select("id,title,handle,gender,price_gbp,tags").eq("collection_slug",c);a&&(i=i.eq("gender",a));const{data:n}=await i;console.log("[ProductGrid] View query result:",n),l=(n||[]).map(r=>({id:r.id,title:r.title,handle:r.handle,gender:r.gender,price_gbp:r.price_gbp,tags:r.tags,is_new:r.tags?.includes("new")}))}else l=((await s).data||[]).map(n=>({...n,is_new:n.tags?.includes("new")}));m(l||[]);const{data:o}=await e.from("product_images").select("product_id,url").order("position",{ascending:!0}),u={};(o||[]).forEach(i=>{i.product_id in u||(u[i.product_id]=i.url)}),p(u)})()},[a,c]);const b=(e,s)=>{s.preventDefault(),s.stopPropagation(),x(l=>{const o=new Set(l);return o.has(e)?o.delete(e):o.add(e),o})},w=e=>e?`Â£${e.toLocaleString("en-GB")}`:"";return t.jsx("div",{className:"w-full bg-white",children:t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-0",children:h.map(e=>(console.log("[ProductGrid] Rendering product:",{id:e.id,handle:e.handle,title:e.title}),t.jsxs("a",{href:`/product?handle=${encodeURIComponent(e.handle)}&id=${encodeURIComponent(e.id)}&from=${encodeURIComponent(window.location.pathname)}`,className:"group relative block border-r border-b border-neutral-100 hover:shadow-lg transition-shadow duration-300",children:[t.jsxs("div",{className:"relative bg-neutral-50",children:[e.is_new&&t.jsx("div",{className:"absolute top-4 left-4 z-10",children:t.jsx("span",{className:"text-[10px] sm:text-xs font-light tracking-wider text-neutral-600",children:"New"})}),t.jsx("div",{className:"aspect-[3/4] overflow-hidden bg-neutral-100",children:t.jsx("img",{src:g[e.id]||"https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?q=80&w=2835&auto=format&fit=crop",alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),t.jsx("button",{onClick:s=>b(e.id,s),className:"absolute bottom-4 right-4 z-10 w-8 h-8 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors","aria-label":"Add to wishlist",children:t.jsx("svg",{className:`w-4 h-4 transition-colors ${f.has(e.id)?"fill-black":"fill-none"} stroke-black stroke-1`,viewBox:"0 0 24 24",children:t.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})})]}),t.jsxs("div",{className:"p-4 sm:p-6 bg-white",children:[t.jsx("h3",{className:"text-xs sm:text-sm font-light tracking-wide text-neutral-900 mb-2",children:e.title}),e.price_gbp&&t.jsx("p",{className:"text-xs sm:text-sm font-light text-neutral-600",children:w(e.price_gbp)})]})]},e.id)))})})}export{P as default};
