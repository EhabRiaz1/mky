import{g as i}from"./supabaseClient.DQBRCACc.js";import{r as u}from"./currency.DLCe802R.js";import"./index.FHxf1fDt.js";import"./index.bmQhMlF6.js";import"./index.yBjzXJbu.js";const o="mky_cart_id";async function d(r){if(typeof window>"u")return null;const t=localStorage.getItem(o);if(t)return t;const e=i();if(!e)return null;const a=r||u(),{data:n,error:c}=await e.from("carts").insert({currency:a}).select("id").single();return c?null:(localStorage.setItem(o,n.id),n.id)}function s(){return typeof window>"u"?null:localStorage.getItem(o)}async function w(r,t,e=1){const a=i();if(!a)return!1;const n=s()||await d();if(!n)return!1;const{error:c}=await a.from("cart_items").insert({cart_id:n,variant_id:r,unit_price_cents:t,quantity:e});return c?!1:(await a.rpc("recompute_cart_totals",{p_cart_id:n}),!0)}async function g(){const r=i();if(!r)return null;const t=s();if(!t)return null;const{data:e}=await r.from("carts").select("*").eq("id",t).single(),{data:a}=await r.from("cart_items").select("*").eq("cart_id",t).order("created_at");return{cart:e,items:a||[]}}async function y(r){const t=i(),e=s();!t||!e||(await t.from("cart_items").delete().eq("id",r),await t.rpc("recompute_cart_totals",{p_cart_id:e}))}export{w as addItemToCart,d as ensureCart,s as getCartId,g as loadCart,y as removeItem};
