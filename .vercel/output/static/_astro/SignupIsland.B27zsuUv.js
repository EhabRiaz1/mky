import{j as e}from"./jsx-runtime.D3GSbgeI.js";import{r as d}from"./index.bmQhMlF6.js";import{c as P}from"./index.FHxf1fDt.js";import"./index.yBjzXJbu.js";const p=P("https://apkohkqyebipmzvdwxgr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwa29oa3F5ZWJpcG16dmR3eGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODQwNDgsImV4cCI6MjA3NDU2MDA0OH0.eEvBZRf_sFDKThtjg9PxqDiK-N4eGkhxpf3W8DNqHQs");function S(){const[i,h]=d.useState(1),[s,l]=d.useState({first_name:"",last_name:"",email:"",password:"",confirmPassword:"",phone:"",line1:"",line2:"",city:"",state:"",postcode:"",country:"GB",marketing_opt_in:!1,showPassword:!1}),[x,f]=d.useState(!1),[g,w]=d.useState(null),[u,b]=d.useState({}),j=a=>{const r={};return a===1&&(s.first_name.trim()||(r.first_name="First name is required"),s.last_name.trim()||(r.last_name="Last name is required"),s.email.trim()||(r.email="Email is required"),/^[\w-\.]+@([\w-]+\.)+[\w-]{2,}$/g.test(s.email)||(r.email="Please enter a valid email"),s.phone.trim()||(r.phone="Phone number is required")),a===2&&(s.line1.trim()||(r.line1="Address line 1 is required"),s.city.trim()||(r.city="City is required"),s.postcode.trim()||(r.postcode="Postcode is required")),a===3&&(s.password.trim()||(r.password="Password is required"),s.password.length<6&&(r.password="Password must be at least 6 characters"),s.confirmPassword.trim()||(r.confirmPassword="Please confirm your password"),s.password!==s.confirmPassword&&(r.confirmPassword="Passwords do not match")),b(r),Object.keys(r).length===0},y=()=>{j(i)&&h(i+1)},v=()=>{h(i-1)};async function N(a){if(a.preventDefault(),!j(i))return;f(!0),w(null);const{data:r,error:o}=await p.auth.signUp({email:s.email,password:s.password,phone:s.phone||void 0});if(o||!r.user){w(o?.message||"Sign up failed"),f(!1);return}const c=r.user.id;let n=null;if(s.line1&&s.city&&s.postcode&&s.country){const{data:m,error:_}=await p.from("addresses").insert({user_id:c,type:"shipping",first_name:s.first_name,last_name:s.last_name,line1:s.line1,line2:s.line2||null,city:s.city,state:s.state||null,postal_code:s.postcode,country:s.country,phone:s.phone||null}).select("id").single();!_&&m&&(n=m.id)}await p.from("profiles").update({first_name:s.first_name,last_name:s.last_name,display_name:`${s.first_name} ${s.last_name}`.trim(),marketing_opt_in:s.marketing_opt_in,default_shipping_address_id:n,default_billing_address_id:n,default_currency:"GBP",terms_accepted_at:new Date().toISOString()}).eq("id",c),location.href="/"}const t=({name:a,type:r="text",placeholder:o,required:c=!1,className:n=""})=>e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:a==="password"||a==="confirmPassword"?s.showPassword?"text":"password":r,placeholder:o,value:s[a],onChange:m=>l({...s,[a]:m.target.value}),required:c,className:`border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-black/10 ${u[a]?"border-red-500":"border-gray-200"} ${n}`}),u[a]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u[a]})]});return e.jsxs("div",{className:"flex justify-center items-center min-h-[500px]",children:[e.jsx("div",{className:"w-full max-w-lg mx-auto bg-white rounded-xl shadow-lg overflow-hidden",children:e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-center mb-6",children:"Create Your Account"}),e.jsxs("form",{onSubmit:N,children:[i===1&&e.jsxs("div",{className:"card bg-white rounded-lg p-6 mb-4 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Personal Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(t,{name:"first_name",placeholder:"First name",required:!0}),e.jsx(t,{name:"last_name",placeholder:"Last name",required:!0})]}),e.jsx(t,{name:"email",type:"email",placeholder:"Email address",required:!0}),e.jsx(t,{name:"phone",placeholder:"Phone number",required:!0})]})]}),i===2&&e.jsxs("div",{className:"card bg-white rounded-lg p-6 mb-4 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Address Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{name:"line1",placeholder:"Address line 1",required:!0}),e.jsx(t,{name:"line2",placeholder:"Address line 2 (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{name:"city",placeholder:"City",required:!0}),e.jsx(t,{name:"state",placeholder:"State/County"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{name:"postcode",placeholder:"Postcode",required:!0}),e.jsxs("select",{value:s.country,onChange:a=>l({...s,country:a.target.value}),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-black/10",children:[e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"IE",children:"Ireland"}),e.jsx("option",{value:"FR",children:"France"}),e.jsx("option",{value:"DE",children:"Germany"}),e.jsx("option",{value:"ES",children:"Spain"}),e.jsx("option",{value:"IT",children:"Italy"})]})]})]})]}),i===3&&e.jsxs("div",{className:"card bg-white rounded-lg p-6 mb-4 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Create Password"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{name:"password",placeholder:"Password",required:!0}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>l({...s,showPassword:!s.showPassword}),children:s.showPassword?"Hide":"Show"})]}),e.jsx(t,{name:"confirmPassword",placeholder:"Confirm password",required:!0}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"marketing",checked:s.marketing_opt_in,onChange:a=>l({...s,marketing_opt_in:a.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"marketing",className:"text-sm",children:"Receive updates and offers"})]})]})]}),g&&e.jsx("div",{className:"text-red-600 text-sm mb-4",children:g}),e.jsxs("div",{className:"flex justify-between mt-6",children:[i>1&&e.jsx("button",{type:"button",onClick:v,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700",children:"Back"}),i<3?e.jsx("button",{type:"button",onClick:y,className:"btn btn-primary rounded-lg",children:"Next"}):e.jsx("button",{type:"submit",className:"btn btn-primary rounded-lg",disabled:x,children:x?"Creating accountâ€¦":"Create account"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white shadow-lg p-2",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4",children:[e.jsx("div",{className:"w-full bg-gray-200 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-black transition-all duration-300 ease-in-out",style:{width:`${i/3*100}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[e.jsx("span",{children:"Personal"}),e.jsx("span",{children:"Address"}),e.jsx("span",{children:"Security"})]})]})})]})}export{S as default};
