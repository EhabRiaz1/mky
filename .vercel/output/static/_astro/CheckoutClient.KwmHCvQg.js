const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/cart.BBzTRO1A.js","_astro/supabaseClient.DQBRCACc.js","_astro/index.FHxf1fDt.js","_astro/index.bmQhMlF6.js","_astro/index.yBjzXJbu.js","_astro/currency.DLCe802R.js"])))=>i.map(i=>d[i]);
import{_}from"./index.FHxf1fDt.js";import{j as a}from"./jsx-runtime.D3GSbgeI.js";import{r as c}from"./index.bmQhMlF6.js";import{loadCart as I}from"./cart.BBzTRO1A.js";import{r as L,f as N}from"./currency.DLCe802R.js";import"./index.yBjzXJbu.js";import"./supabaseClient.DQBRCACc.js";var x="https://js.stripe.com/v3",O=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var k=function(){for(var r=document.querySelectorAll('script[src^="'.concat(x,'"]')),e=0;e<r.length;e++){var n=r[e];if(O.test(n.src))return n}return null},E=function(r){var e="",n=document.createElement("script");n.src="".concat(x).concat(e);var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(n),n},l=null,f=null,p=null,A=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},R=function(r,e){return function(){window.Stripe?r(window.Stripe):e(new Error("Stripe.js not available"))}},T=function(r){return l!==null?l:(l=new Promise(function(e,n){if(typeof window>"u"||typeof document>"u"){e(null);return}if(window.Stripe){e(window.Stripe);return}try{var t=k();if(!(t&&r)){if(!t)t=E(r);else if(t&&p!==null&&f!==null){var s;t.removeEventListener("load",p),t.removeEventListener("error",f),(s=t.parentNode)===null||s===void 0||s.removeChild(t),t=E(r)}}p=R(e,n),f=A(n),t.addEventListener("load",p),t.addEventListener("error",f)}catch(u){n(u);return}}),l.catch(function(e){return l=null,Promise.reject(e)}))},d,G=function(){return d||(d=T(null).catch(function(r){return d=null,Promise.reject(r)}),d)};Promise.resolve().then(function(){return G()}).catch(function(o){console.warn(o)});function D(){const[o,r]=c.useState(null),[e,n]=c.useState(0),[t,s]=c.useState("GBP"),[u,j]=c.useState(""),[S,h]=c.useState(!1),[g,P]=c.useState(null);c.useEffect(()=>{(async()=>{s(L());const m=(await I())?.cart?.total_cents||0;n(m)})()},[]);async function b(){h(!0);try{const i=(await _(async()=>{const{getCartId:C}=await import("./cart.BBzTRO1A.js");return{getCartId:C}},__vite__mapDeps([0,1,2,3,4,5]))).getCartId?.();i&&(document.cookie=`mky_cart_id=${i}; Path=/; Max-Age=31536000`);const m=await fetch("/api/place-order",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:u})}),v=await m.json();if(!m.ok)throw new Error(v.error||"order_failed");P(v.orderId);const w=await fetch("/api/create-payment-intent",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({orderId:v.orderId})}),y=await w.json();if(!w.ok)throw new Error(y.error||"payment_intent_failed");r(y.clientSecret||null)}catch(i){alert(i.message||"Checkout failed")}finally{h(!1)}}return a.jsxs("div",{className:"card p-4",children:[a.jsx("div",{className:"mb-2 text-neutral-600",children:"Amount"}),a.jsx("div",{className:"text-xl font-semibold",children:N(e,t)}),!o&&a.jsxs("div",{className:"mt-4 grid gap-3 max-w-md",children:[a.jsx("input",{type:"email",placeholder:"Email (for order confirmation)",className:"border p-2 rounded",value:u,onChange:i=>j(i.target.value)}),a.jsx("button",{className:"btn btn-primary",disabled:S||e<=0,onClick:b,children:S?"Confirmingâ€¦":"Confirm Order"})]}),a.jsx("div",{className:"mt-4 text-neutral-600",children:"Stripe Elements form will render on clientSecret."}),o?a.jsxs("div",{className:"mt-4 text-sm text-neutral-700",children:["Payment intent created. Integrate Elements CardElement here for order ",g?.slice(0,8),"."]}):a.jsx("div",{className:"mt-4 text-sm text-neutral-700",children:"Add items to cart and confirm to begin payment."})]})}export{D as default};
