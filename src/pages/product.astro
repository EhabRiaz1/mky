---
import ProductDetail from "../components/ProductDetail.tsx";
import SimilarProducts from "../components/SimilarProducts.tsx";
import BaseLayout from "../layouts/BaseLayout.astro";
const handle = Astro.url.searchParams.get('handle') ?? '';
const id = Astro.url.searchParams.get('id') ?? '';
const referrer = Astro.url.searchParams.get('from') ?? '';

// Determine back link and text based on referrer
let backLink = '/products';
let backText = 'Back to shop';

if (referrer.includes('blazers')) {
  backLink = referrer;
  backText = 'Back to Blazers';
} else if (referrer.includes('trousers')) {
  backLink = referrer;
  backText = 'Back to Trousers';
} else if (referrer.includes('men')) {
  backLink = referrer;
  backText = 'Back to Men\'s Collection';
} else if (referrer.includes('women')) {
  backLink = referrer;
  backText = 'Back to Women\'s Collection';
}
console.log('*** [Product.astro] Parsed searchParams:', Astro.url.searchParams);
console.log('*** [Product.astro] Passing to ProductDetail:', { handle, id });
---
<BaseLayout title="Product â€” Maison MKY" fullWidth={true}>
  <div class="p-0 m-0 relative">
    <a href={backLink} class="fixed top-24 left-6 z-10 px-6 py-2 text-[rgb(38,19,21)] text-xs font-light tracking-widest uppercase hover:opacity-60 transition-all duration-300 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      {backText}
    </a>
    
    <div>
      <ProductDetail client:load handle={handle} id={id} />
    </div>
    
    <!-- Horizontal Divider before Similar Products -->
    <div class="w-full border-t border-[rgb(38,19,21)] opacity-20 my-16"></div>
    
    <!-- Similar Products Section - Dynamic based on current product -->
    <div class="px-4 md:px-6 mb-16">
      <SimilarProducts client:load productId={id} handle={handle} limit={4} />
    </div>
  </div>
</BaseLayout>

<style is:global>
  #main-header { background-color: var(--brand-bg-exact) !important; }
  #main-header.backdrop-blur-md { background-color: var(--brand-bg-exact) !important; }
</style>

